//const { post } = require("jquery");

const formPerguntaChat = document.getElementById('pergunte-chat-gpt');
const OPENAI_API_KEY = "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";

if(formPerguntaChat){
        formPerguntaChat.addEventListener("submit", async (e) =>{

        e.preventDefault();
        let pergunta = document.getElementById('campo-pergunta').value;
        
        document.getElementById('btn-pergunte-chat-gpt').value = "Pesquisando a resposta";

        document.getElementById('pergunta').innerHTML = pergunta;

        document.getElementById('resposta').innerHTML = "<span></span>";
        await fetch("https://api.openai.com/v1/completions", {
            method: "POST",

            headers:{
                Accept: "application/json",
                "Content-Type": "application/json",

                Authorization: "Bearer " + OPENAI_API_KEY,
            },

            body: JSON.stringify({
                model: "text-davinci-003",
                prompt: pergunta,
                max_tokens: 2048,
                temperature: 0.5
            }),

        })

        .then((resposta) => resposta.json())
        .then((dados) => {
            //console.log(dados);
            //console.log(dados.choices[0].text);
            document.getElementById('resposta').innerHTML = dados.choices[0].text;
        })
        .catch((erro)=>{
            console.log(erro);
            document.getElementById('resposta').innerHTML = "Sem resposta";
        })

        document.getElementById('btn-pergunte-chat-gpt').value = "Enviar";

    });
}